os:
  - linux
  - osx
  - windows
language: rust
rust:
  - stable
  
# https://levans.fr/rust_travis_cache.html
cache:
  directories:
    - /home/travis/.cargo
before_cache:
  - rm -rf /home/travis/.cargo/registry
  
before_install:
  - rustup toolchain add nightly
  - rustup component add clippy --toolchain=nightly
  - rustup component add rustfmt
 
script:
  - cargo test --verbose --workspace
  - cargo +nightly clippy
  - cargo fmt -- --check
  - cargo run
  - cargo run -- .

before_deploy:
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then export TARGET=x86_64-unknown-linux-musl  ; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get update && sudo apt-get -y install musl-tools  ; fi
  
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then export TARGET=x86_64-apple-darwin  ; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then export MACOSX_DEPLOYMENT_TARGET=10.7  ; fi

  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then export TARGET=x86_64-pc-windows-msvc  ; fi
  
  - rustup target add $TARGET
  - cargo build --release --target $TARGET
  - cp target/$TARGET/release/rpg-cli "rpg-cli-$TRAVIS_OS_NAME-$TRAVIS_TAG"
deploy:
  provider: releases
  api_key:
    secure: "dKv75PDJ4F23NJfT/V4wVxpZBe3FwagzuzIKag+HDHaEVLsttWmyzzcjb/pz0AfEAXtu6vDe3ARgjqiLU4pzR8CWnl2uCxRkcubHykCfBl9a0b1WIb1+Zvr9Bc8vAd/LWmxR5gzh3Qzlkv+C8GmK9sY58rEhLxGn2N6rTVbaLX8XV4JJZOc0MONbJDDR8o1RuRcUktPOrRPvfHeCMTbTLdJmhYZgE2NxoT8Tj0ricl7Fjj0EH8+lxh141ymaqNxlnPXN1NYd5WONIo5nfZtI3NoLArCQ4ZEuNMKTUmvurzGW/kGd4ML4drGIBcKhWm8Ceyc4yGcDP48RCEEoZRHS2catP/aLkzukqyalqgwhNrtm/u4TsZrCRLNdxa0uklFuyGPokj5N+5yBKgsFjSv3/Mhhhzr18xxDBzM7MUwIM1O+jL78r8+gNr2Pp4o2t3KIlABn0w1Sa+qBp6sEMaT8DuqEKOIk1EHng4zCvyqQzwwZwAJoM+arOxrACeKNp5CdPj3SMPqAHqwOLdEHlqvmLNuEDpgYdyg2no7/ylRW6Vdah7pVmjjCZarOa+UcNHTR+n5Iau6k8KUQ8nJNAwF/3vK2ag3qZZ9xLZHso/IOI7zynErunlC/2ycSM1t5tJv1yon2CTFDc7/CpG/lGM6VjsJEPu36ttIdoksjT1bxS40="

  file: "rpg-cli-$TRAVIS_OS_NAME-$TRAVIS_TAG"
  skip_cleanup: true
  draft: true
  on:
    # FIXME uncomment, remove draft & branch, set tags: true
    branch: github_releases
  
